version: '3'
services:
  geth:
    image: trufflesuite/ganache-cli
    ports:
      - "8545:8545"
    command: 
      - ganache-cli
      - "-l 8000000"
      - "-g 1000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501200,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501201,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501202,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501203,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501204,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501205,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501206,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501207,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501208,1000000000000000000000000"
      - --account
      - "0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501209,1000000000000000000000000"
  nodedb:
    image: postgres
    ports:
      - "5432:5432"
    restart: on-failure
    environment:
      - POSTGRES_PASSWORD=bitclave
      - POSTGRES_USER=postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data/
  base-node:
    image: base/node
    ports:
      - "8080:8080"
    depends_on:
      - nodedb
      - geth
    environment:
      - PROFILE=docker
      - JDBC_DATABASE_URL=jdbc:postgresql://nodedb:5432/postgres
      - JDBC_DATABASE_USERNAME=postgres
      - JDBC_DATABASE_PASSWORD=bitclave
      - ETHEREUM_RPC_URL=http://geth:8545/
      - OWNER_PRIVATE_KEY=0x2bdd21761a483f71054e14f5b827213567971c676928d9a1808cbfa4b7501200
      - DNS_CONTRACT_ADDRESS=0x0f5ea0a652e851678ebf77b69484bfcd31f9459b
      - ETHEREUM_GAS_PRICE=8000000
      - ETHEREUM_GAS_LIMIT=8000000
  matcher:
    image: base/matcher
    depends_on:
      - base-node
    restart: on-failure
    environment: 
      - BASE_NODE_URL=http://base-node:8080/
volumes:
  postgres_data: {}